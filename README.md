# Калькулятор Отпускных

Сервис на Spring Boot для расчета суммы отпускных выплат сотрудника.

## Описание задачи

Приложение предоставляет REST API для расчета отпускных на основе средней заработной платы и параметров отпуска.

### Функциональные требования

**Базовый функционал:**
- Расчет отпускных по средней зарплате за 12 месяцев и количеству дней отпуска

**Расширенный функционал:**
- Расчет отпускных с учетом конкретных дат отпуска
- Автоматическое исключение праздничных дней из расчета
- Валидация входных данных

## Технологический стек

- **Java**: 11
- **Spring Boot**: 2.7.18
- **Maven**: система сборки
- **REST Assured**: интеграционное тестирование
- **JUnit 5**: модульное тестирование
- **Mockito**: мокирование зависимостей

## API

### Расчет отпускных

```
GET /calculacte
Content-Type: application/json
```

#### Параметры запроса

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| `averageSalary` | BigDecimal | Да | Средняя зарплата за 12 месяцев (должна быть > 0) |
| `daysVacation` | Integer | Нет* | Количество дней отпуска (должно быть > 0) |
| `dateStart` | LocalDate | Нет* | Дата начала отпуска (формат: YYYY-MM-DD) |
| `dateEnd` | LocalDate | Нет* | Дата окончания отпуска (формат: YYYY-MM-DD) |

\* Должен быть указан либо `daysVacation`, либо пара `dateStart` и `dateEnd`

#### Примеры запросов

**Расчет по количеству дней:**
```json
{
  "averageSalary": 100000,
  "daysVacation": 14
}
```

**Расчет по датам отпуска:**
```json
{
  "averageSalary": 50000,
  "dateStart": "2026-01-01",
  "dateEnd": "2026-01-10"
}
```

#### Пример успешного ответа

```json
{
  "totalVacationPay": 47781.57
}
```

#### Примеры ошибок

**Ошибка валидации (400 Bad Request):**
```json
{
  "validationErrors": [
    {
      "field": "averageSalary",
      "message": "Average salary is required"
    }
  ]
}
```

**Бизнес-ошибка (400 Bad Request):**
```json
{
  "message": "Either vacation days or vacation period dates must be specified",
  "code": "VACATION_PARAMETERS_MISSING"
}
```

## Формула расчета

Отпускные рассчитываются по формуле:

```
Отпускные = (Средняя зарплата / 29.3) × Количество оплачиваемых дней
```

где:
- **29.3** — среднемесячное число календарных дней (установлено ТК РФ)
- **Количество оплачиваемых дней** — количество дней отпуска за вычетом праздничных дней (при расчете по датам)

## Архитектура проекта

### Структура пакетов

```
ru.viktorgezz.vacation_pay_calculator
├── calculation/              # Логика расчета отпускных
│   ├── strategy/            # Стратегии расчета
│   │   ├── impl/           # Реализации стратегий
│   │   └── intrf/          # Интерфейсы стратегий
│   └── util/               # Утилиты расчета
├── controller/              # REST контроллеры
├── dto/                     # Data Transfer Objects
├── exception/               # Бизнес-исключения
├── handler/                 # Обработчики исключений
├── holiday/                 # Работа с праздничными днями
├── service/                 # Бизнес-логика
│   └── impl/               # Реализации сервисов
└── validation/              # Валидация запросов
```

### Применяемые паттерны проектирования

#### 1. Strategy Pattern (Стратегия)
Используется для выбора алгоритма расчета отпускных в зависимости от входных параметров:

- **`FixedDaysCalculationStrategy`** — расчет по фиксированному количеству дней
- **`CalendarBasedCalculationStrategy`** — расчет по календарным датам с учетом праздников

**Преимущества:**
- Легкое добавление новых способов расчета
- Соблюдение принципа Open/Closed (SOLID)

## Запуск приложения

### Требования
- Java 11 или выше
- Maven 3.6+

### Сборка проекта
```bash
./mvnw clean install
```

### Запуск приложения
```bash
./mvnw spring-boot:run
```

Приложение будет доступно по адресу: `http://localhost:8080`

### Запуск тестов
```bash
# Все тесты
./mvnw test

# Только модульные тесты
./mvnw test -Dtest=*Test

# Только интеграционные тесты
./mvnw test -Dtest=VacationPayControllerTest
```

## Обработка ошибок

### Коды бизнес-ошибок

| Код | HTTP Status | Описание |
|-----|-------------|----------|
| `VACATION_PARAMETERS_MISSING` | 400 | Не указаны ни дни отпуска, ни даты периода |
| `VACATION_PARAMETERS_ALL_SPECIFIED` | 400 | Указаны и дни отпуска, и даты одновременно |
| `VACATION_DATES_INCOMPLETE` | 400 | Указана только одна из дат (начало или окончание) |
| `INVALID_VACATION_PERIOD` | 400 | Дата начала отпуска позже даты окончания |
| `INTERNAL_EXCEPTION` | 500 | Внутренняя ошибка сервера |

### Ошибки валидации

Возвращаются при нарушении ограничений на поля:
- Отсутствие обязательного поля `averageSalary`
- Отрицательное или нулевое значение `averageSalary`
- Отрицательное значение `daysVacation`

## Особенности реализации

### Праздничные дни
Приложение учитывает официальные праздничные дни России, загружаемые из JSON-файла `holidays.json`. При расчете по датам праздничные дни автоматически исключаются из оплачиваемых дней отпуска.

### Точность расчетов
Все денежные расчеты выполняются с использованием `BigDecimal` для обеспечения точности финансовых операций.